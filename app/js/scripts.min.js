document.addEventListener('DOMContentLoaded', function() {

	// Modal Form
	let btnServices = document.querySelectorAll('.btn-modal');
	let modal = document.querySelector('.modalBlock');
	let formBg = document.querySelector('.modalBlock__overlay');

	function showModal(e) {
		e.preventDefault();
		modal.classList.add('modalBlock_active');
	}
	function hideModal() {
		modal.classList.remove('modalBlock_active');
	}

	for (let i = 0; i < btnServices.length; i++) {
		btnServices[i].addEventListener('click', showModal);
	}

	if(modal) {
		formBg.addEventListener('click', hideModal);
	}
	
	// Функция ресайза
	function getWindowWidth() {
		return window.innerWidth || document.body.clientWidth;
	}

	if(getWindowWidth() >= 991) {

		var searchIcon = document.querySelector('.header-block__search-icon');
		var searchInput = document.querySelector('.header-block__search-input');

		function animSearch() {
			searchIcon.classList.toggle('header-block__search-icon-animation');
			searchInput.classList.toggle('header-block__search-input-animation');
			mapIcon.classList.remove('header-block__map-icon-animation');
			mapIsrael.classList.remove('header-block__map-country-israel-animation');
			mapUSA.classList.remove('header-block__map-country-usa-animation');
			mapRussia.classList.remove('header-block__map-country-russia-animation');
		}
		searchIcon.addEventListener('click', animSearch);

		var mapIcon = document.querySelector('.header-block__map-icon');
		var mapIsrael = document.querySelector('.header-block__map-country-israel');
		var mapUSA = document.querySelector('.header-block__map-country-usa');
		var mapRussia = document.querySelector('.header-block__map-country-russia');

		function animMap() {
			mapIcon.classList.toggle('header-block__map-icon-animation');
			mapIsrael.classList.toggle('header-block__map-country-israel-animation');
			mapUSA.classList.toggle('header-block__map-country-usa-animation');
			mapRussia.classList.toggle('header-block__map-country-russia-animation');
			searchIcon.classList.remove('header-block__search-icon-animation');
			searchInput.classList.remove('header-block__search-input-animation');
		}
		mapIcon.addEventListener('click', animMap);

		// Слайдер
		var directionSlider = document.getElementById('landingSlider__noUiSlider');

		let box = document.querySelectorAll('.js-filter');
		let arr1 = [],
			arr2 = [],
			arr3 = [],
			arr4 = [],
			arr5 = [];

		for (let i = 0; i < box.length; i++) {
			if (box[i].getAttribute('data-price') == '1'){

				arr1.push(box[i]);

			} else if (box[i].getAttribute('data-price') == '2'){

				arr2.push(box[i]);

			} else if (box[i].getAttribute('data-price') == '3') {

				arr3.push(box[i]);

			} else if (box[i].getAttribute('data-price') == '4') {

				arr4.push(box[i]);
			} else if (box[i].getAttribute('data-price') == '5') {

				arr5.push(box[i]);
			}
			
		}

		function allHide() {
			for (let i = 0; i < box.length; i++) {

				box[i].classList.remove('is-shows');
				
			}
		}

		var carts = document.querySelectorAll('.landingCart__box-outer');

		if (directionSlider) {

			carts[0].addEventListener('click', function() {
				directionSlider.noUiSlider.set(0);
			});
			carts[1].addEventListener('click', function() {
				directionSlider.noUiSlider.set(1);
			});
			carts[2].addEventListener('click', function() {
				directionSlider.noUiSlider.set(2);
			});
			carts[3].addEventListener('click', function() {
				directionSlider.noUiSlider.set(3);
			});
			carts[4].addEventListener('click', function() {
				directionSlider.noUiSlider.set(4);
			});

			noUiSlider.create(directionSlider, {
				start: 0,
				connect: [true, false],
				step: 1,
				behaviour: 'hover-snap',
				format: wNumb({
					decimals: 0
				}),
				range: {
					min: 0,
					max: 4
				},
				pips: {
					mode: 'steps',
					values: 5,
					density: -1,
					format: wNumb({
						decimals: 0,
						prefix: ''
					})
				}
			});

			directionSlider.noUiSlider.on('update', function (values, handle) {

				if (values == 0){

					allHide();

					for (let i = 0; i < arr1.length; i++) {

						arr1[i].classList.add('is-shows');
						
					}

				} else if (values == 1) {

					allHide();

					for (let i = 0; i < arr2.length; i++) {

						arr2[i].classList.add('is-shows');
						
					}
				} else if (values == 2) {

					allHide();

					for (let i = 0; i < arr3.length; i++) {

						arr3[i].classList.add('is-shows');
						
					}
				} else if (values == 3) {

					allHide();

					for (let i = 0; i < arr4.length; i++) {

						arr4[i].classList.add('is-shows');
						
					}
				} else if (values == 4) {

					allHide();

					for (let i = 0; i < arr5.length; i++) {

						arr5[i].classList.add('is-shows');
						
					}
				}

			});

		}
		
		$('.js-spoiler-trigger').click(function() {
			$(`[data-id=${this.dataset.target}]`).slideToggle('normal');
		});

		

	} else if(getWindowWidth() <= 991) {

		// Анимация поиска
		var searchIconMob = document.querySelector('.header-block__search-icon');
		var headMob = document.querySelector('.header-mob');

		function tachSearch() {
			headMob.classList.toggle('header-mob-animation');
			headMap.classList.remove('header-cont-animation');
			mobMenu.classList.remove('jsmenu_active');
			burgerIcon.classList.remove('header-block__mobile-burger-active');
		}
		searchIconMob.addEventListener('click', tachSearch);
		// Анимация карты
		var mapIconMob = document.querySelector('.header-block__map-icon');
		var headMap = document.querySelector('.header-cont');

		function tachMap() {
			headMap.classList.toggle('header-cont-animation');
			headMob.classList.remove('header-mob-animation');
			mobMenu.classList.remove('jsmenu_active');
			burgerIcon.classList.remove('header-block__mobile-burger-active');
		}
		mapIconMob.addEventListener('click', tachMap);

		// Анимация бургер меню
		var burgerTouch = document.querySelector('.header-block__mobile');
		var burgerIcon = document.querySelector('.header-block__mobile-burger');
		var mobMenu= document.querySelector('.jsmenu');

		function burgerMenu() {
			burgerIcon.classList.toggle('header-block__mobile-burger-active');
			mobMenu.classList.toggle('jsmenu_active');
			headMap.classList.remove('header-cont-animation');
			headMob.classList.remove('header-mob-animation');
		}
		burgerTouch.addEventListener('click', burgerMenu);

		// Мобильное меню
		// var slinky = $('.jsmenu').slinky({
		// 	title: true,
		// 	speed: 300
		// });

		var carts = document.querySelectorAll('.landingCart__box-outer');

		var filter = document.querySelectorAll('.js-filter');

		for (let i = 0; i < carts.length; i++) {
			carts[i].addEventListener('click', function() {
				filter[i].classList.toggle('is-shows');
			});
		}

	}
		
});
!function(){"use strict";function o(){var o=window,t=document;if(!("scrollBehavior"in t.documentElement.style&&!0!==o.__forceSmoothScrollPolyfill__)){var l,e=o.HTMLElement||o.Element,r=468,i={scroll:o.scroll||o.scrollTo,scrollBy:o.scrollBy,elementScroll:e.prototype.scroll||n,scrollIntoView:e.prototype.scrollIntoView},s=o.performance&&o.performance.now?o.performance.now.bind(o.performance):Date.now,c=(l=o.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(l)?1:0);o.scroll=o.scrollTo=function(){void 0!==arguments[0]&&(!0!==f(arguments[0])?h.call(o,t.body,void 0!==arguments[0].left?~~arguments[0].left:o.scrollX||o.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:o.scrollY||o.pageYOffset):i.scroll.call(o,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:o.scrollX||o.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:o.scrollY||o.pageYOffset))},o.scrollBy=function(){void 0!==arguments[0]&&(f(arguments[0])?i.scrollBy.call(o,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):h.call(o,t.body,~~arguments[0].left+(o.scrollX||o.pageXOffset),~~arguments[0].top+(o.scrollY||o.pageYOffset)))},e.prototype.scroll=e.prototype.scrollTo=function(){if(void 0!==arguments[0])if(!0!==f(arguments[0])){var o=arguments[0].left,t=arguments[0].top;h.call(this,this,void 0===o?this.scrollLeft:~~o,void 0===t?this.scrollTop:~~t)}else{if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");i.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}},e.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==f(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):i.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},e.prototype.scrollIntoView=function(){if(!0!==f(arguments[0])){var l=function(o){for(;o!==t.body&&!1===(e=p(l=o,"Y")&&a(l,"Y"),r=p(l,"X")&&a(l,"X"),e||r);)o=o.parentNode||o.host;var l,e,r;return o}(this),e=l.getBoundingClientRect(),r=this.getBoundingClientRect();l!==t.body?(h.call(this,l,l.scrollLeft+r.left-e.left,l.scrollTop+r.top-e.top),"fixed"!==o.getComputedStyle(l).position&&o.scrollBy({left:e.left,top:e.top,behavior:"smooth"})):o.scrollBy({left:r.left,top:r.top,behavior:"smooth"})}else i.scrollIntoView.call(this,void 0===arguments[0]||arguments[0])}}function n(o,t){this.scrollLeft=o,this.scrollTop=t}function f(o){if(null===o||"object"!=typeof o||void 0===o.behavior||"auto"===o.behavior||"instant"===o.behavior)return!0;if("object"==typeof o&&"smooth"===o.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+o.behavior+" is not a valid value for enumeration ScrollBehavior.")}function p(o,t){return"Y"===t?o.clientHeight+c<o.scrollHeight:"X"===t?o.clientWidth+c<o.scrollWidth:void 0}function a(t,l){var e=o.getComputedStyle(t,null)["overflow"+l];return"auto"===e||"scroll"===e}function d(t){var l,e,i,c,n=(s()-t.startTime)/r;c=n=n>1?1:n,l=.5*(1-Math.cos(Math.PI*c)),e=t.startX+(t.x-t.startX)*l,i=t.startY+(t.y-t.startY)*l,t.method.call(t.scrollable,e,i),e===t.x&&i===t.y||o.requestAnimationFrame(d.bind(o,t))}function h(l,e,r){var c,f,p,a,h=s();l===t.body?(c=o,f=o.scrollX||o.pageXOffset,p=o.scrollY||o.pageYOffset,a=i.scroll):(c=l,f=l.scrollLeft,p=l.scrollTop,a=n),d({scrollable:c,method:a,startTime:h,startX:f,startY:p,x:e,y:r})}}"object"==typeof exports&&"undefined"!=typeof module?module.exports={polyfill:o}:o()}();
document.addEventListener('DOMContentLoaded', function() {


	// Прелоадер
	let imgs = document.images,
		imagesTotalCount = imgs.length,
		imagesLoadedCount = 0,
		preloader = document.querySelector('.page-preloader');
	
	for (let i = 0; i < imagesTotalCount; i++) {
		var imageClone = new Image();
		imageClone.onload = imageLoaded;
		imageClone.onerror = imageLoaded;
		imageClone.src = imgs[i].src;
	}

	function imageLoaded() {
		imagesLoadedCount++;

		if (imagesLoadedCount >= imagesTotalCount) {
			setTimeout(function(){
				if(!preloader.classList.contains('is-hide'))
				preloader.classList.add('is-hide');
			}, 1000)
		}
	}


	// Прогресс бар
	let progress = document.querySelector('.progress-bar');

	window.addEventListener('scroll', progressBar);

	function progressBar(e){
		let windowScroll = document.body.scrollTop || document.documentElement.scrollTop;
		let windowHeigth = document.documentElement.scrollHeight - document.documentElement.clientHeight;
		let per = windowScroll / windowHeigth * 100;

		progress.style.width = per + '%';
	}


	// Кнопка на верх
	buttonToTop = document.querySelector('.button-to-top');

	function showButtonToTop() {
		
		let windowScroll = window.pageYOffset; // Another Browsers

		if (windowScroll > 400) {
			buttonToTop.classList.add('is-show');
		} else {
			buttonToTop.classList.remove('is-show');
		}
	};
	window.addEventListener('scroll', showButtonToTop);

	function scrollToTop(e) {
		e.preventDefault();
		window.scroll({ top: 0, left: 0, behavior: 'smooth' });
	};
	buttonToTop.addEventListener('click', scrollToTop);


	/* Glide.js Slider */

    let sliderNews = document.querySelector('.glide_news');
	let sliderMain = document.querySelector('.glide_main');

	function generateBulletsAndMountGlide(el, nameSlider, nameClass,) {
		let bulletCount = document.querySelectorAll(`${nameSlider} .glide__slide`).length;
		let bulletWrapper = document.querySelector(nameClass);
	
		for (let index = 0; index < bulletCount; index++) {
			const button = document.createElement('button');
			button.className = 'glide__bullet';
			button.setAttribute("data-glide-dir", '='+index);
	
			bulletWrapper.appendChild(button);
		}
	
		el.mount();
	}

	if (sliderNews || sliderMain) {

		let glideMain = new Glide(sliderMain, {
			type: 'slider',
			autoplay: 7000,
			hoverpause: true,
			startAt: 0,
			perView: 1,
			animationDuration: 1000,
			rewindDuration: 800
		});

		generateBulletsAndMountGlide(glideMain, '.glide_main', '.slider__bullets');

		let glideNews = new Glide(sliderNews, {
			type: 'carousel',
			gap: 30,
			startAt: 0,
			perView: 3,
			animationDuration: 1000,
			breakpoints: {
				1024: {
				  perView: 2
				},
				768: {
					gap: 20,
				  perView: 2
				},
				576: {
				  perView: 1
				}
			}
		});

		generateBulletsAndMountGlide(glideNews, '.glide_news','.news__bullets');
	}
	/* Glide.js Slider */

});